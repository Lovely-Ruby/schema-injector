import fs from 'fs'
import path from 'path'

const LOG_DIR = path.resolve(process.cwd(), 'logs')

if (!fs.existsSync(LOG_DIR)) {
  fs.mkdirSync(LOG_DIR)
}

export function logInjectError(payload: {
  index: number
  url: string
  request: any
  response?: any
  error: any
}) {
  const file = path.join(
    LOG_DIR,
    `inject-error-${new Date().toISOString().slice(0, 10)}.json`
  )

  const record = {
    time: new Date().toISOString(),
    ...payload,
  }

  let list: any[] = []

  if (fs.existsSync(file)) {
    list = JSON.parse(fs.readFileSync(file, 'utf-8'))
  }

  list.push(record)

  fs.writeFileSync(file, JSON.stringify(list, null, 2))
}
